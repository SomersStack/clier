{"id":"clier-0hn","title":"CLI service tests have outdated parameter expectations","description":"## Summary\nCLI service stop/restart command tests fail because they don't expect the 'force' parameter.\n\n## Affected Tests\n- tests/unit/cli/service.test.ts (2 tests failed)\n  - serviceStopCommand \u003e should stop a service successfully\n  - serviceRestartCommand \u003e should restart a service successfully\n\n## Error Pattern\n```\nAssertionError: expected \"spy\" to be called with arguments: [ 'process.stop', { name: 'my-service' } ]\nReceived: [ 'process.stop', { force: false, name: 'my-service' } ]\n```\n\n## Root Cause\nImplementation now includes a 'force' parameter but tests haven't been updated.\n\n## Test Output\n/private/tmp/claude/-Users-olliesomers-dev-clier/tasks/b6614b5.output\n\n## Fix\nUpdate test expectations to include `force: false` in the expected parameters.","status":"closed","priority":3,"issue_type":"bug","owner":"olliesomers@me.com","created_at":"2026-01-23T18:51:25.253908+08:00","created_by":"SomersStack","updated_at":"2026-01-23T19:02:01.566385+08:00","closed_at":"2026-01-23T19:02:01.566385+08:00","close_reason":"Tests already had force: false parameter - verified all 19 tests pass"}
{"id":"clier-1f5","title":"Add log rotation and signal handling tests","description":"Missing test coverage for: (1) Log file rotation behavior in LogManager when files exceed maxFileSize, (2) Signal handling (SIGTERM/SIGINT) for graceful shutdown in Watcher and CLI commands, (3) Log persistence across multiple runs. These are critical production behaviors that should be validated.","status":"closed","priority":3,"issue_type":"task","owner":"ollie@aglaiaim.com","created_at":"2026-01-22T15:46:40.804486+08:00","created_by":"Ollie Somers","updated_at":"2026-01-23T19:35:04.875528+08:00","closed_at":"2026-01-23T19:35:04.875528+08:00","close_reason":"Added comprehensive log manager tests covering log rotation, persistence across runs, ring buffer behavior, and file operations. The existing watcher.test.ts already covers signal handling behavior adequately."}
{"id":"clier-1ks","title":"Phase 5: Testing \u0026 Example Scenarios","description":"Create example config (lint→build→api pipeline), write E2E tests (full pipeline execution with real PM2, circuit breaker triggering, continue-on-failure behavior, multi-pattern event emission), create documentation in /docs (API reference, configuration guide, example pipelines in /docs/examples/)","status":"closed","priority":2,"issue_type":"task","owner":"olliesomers1@gmail.com","created_at":"2026-01-21T13:06:42.298875+08:00","created_by":"OliverSomers","updated_at":"2026-01-21T14:51:12.034962+08:00","closed_at":"2026-01-21T14:51:12.034962+08:00","close_reason":"Closed","labels":["documentation","e2e-tests","phase5"],"dependencies":[{"issue_id":"clier-1ks","depends_on_id":"clier-f2w","type":"blocks","created_at":"2026-01-21T13:06:57.36844+08:00","created_by":"OliverSomers"}]}
{"id":"clier-1p0","title":"Phase 6: Testing daemon implementation","description":"Unit tests, integration tests, E2E tests for daemon","status":"open","priority":2,"issue_type":"task","owner":"ollie@aglaiaim.com","created_at":"2026-01-22T16:10:32.323597+08:00","created_by":"Ollie Somers","updated_at":"2026-01-22T16:10:32.323597+08:00","dependencies":[{"issue_id":"clier-1p0","depends_on_id":"clier-hnv","type":"blocks","created_at":"2026-01-22T16:12:42.939396+08:00","created_by":"Ollie Somers"}]}
{"id":"clier-1ws","title":"Remove PM2 references from documentation","description":"The documentation in docs/README.md still claims Clier is 'PM2-based' throughout, but PM2 was completely removed in commit 2111681. This creates confusion about what Clier actually is. Need to update all docs to describe the native child_process implementation, update architecture diagrams, and clarify the foreground process model vs daemon expectations.","status":"closed","priority":1,"issue_type":"task","owner":"ollie@aglaiaim.com","created_at":"2026-01-22T15:46:25.201266+08:00","created_by":"Ollie Somers","updated_at":"2026-01-22T17:11:32.361725+08:00","closed_at":"2026-01-22T17:11:32.361725+08:00","close_reason":"Documentation updated to reflect daemon architecture, all PM2 references removed"}
{"id":"clier-2si","title":"Implement native daemon architecture","status":"closed","priority":0,"issue_type":"feature","owner":"ollie@aglaiaim.com","created_at":"2026-01-22T16:10:21.578042+08:00","created_by":"Ollie Somers","updated_at":"2026-01-22T17:10:27.312541+08:00","closed_at":"2026-01-22T17:10:27.312541+08:00","close_reason":"Daemon architecture fully implemented - Phases 1-4 complete with working multi-agent session support"}
{"id":"clier-42n","title":"Add negative-path E2E tests (daemon crash, config corruption, socket drop)","description":"## Problem\nThere are no E2E tests for failure/recovery scenarios. The existing E2E tests only cover happy-path configurations (working pipelines, successful process starts). Production systems need to handle:\n\n## Missing test scenarios\n1. **Daemon crash mid-pipeline**: What happens to running processes if the daemon process dies unexpectedly? Do they become orphaned? Can a new daemon reconnect to them?\n2. **Config corruption at runtime**: What happens if the pipeline config file is modified or deleted while the daemon is running? Does `clier reload` handle this gracefully?\n3. **Socket connection drop**: What happens when a CLI client loses connection to the daemon mid-request? Does the client report a clear error? Does the daemon clean up the abandoned connection?\n4. **Process spawn failure**: What happens when a configured command doesn't exist (e.g., typo in binary name)? Does the pipeline halt or continue based on continue_on_failure?\n5. **Port/resource conflicts**: What happens when two pipelines try to bind the same port or socket? Is the error message clear?\n6. **Cascading failures**: What happens when a service crashes, triggers restart, crashes again, exceeds max_restarts — does the circuit breaker engage properly? Does the rest of the pipeline continue?\n\n## Priority rationale\nP2 — These are important for production confidence but are harder to write than fixing existing test assertions (clier-j0g). Should be tackled after the existing E2E assertions are strengthened.","status":"open","priority":2,"issue_type":"task","owner":"olliesomers@me.com","created_at":"2026-02-06T22:31:50.203994+08:00","created_by":"SomersStack","updated_at":"2026-02-06T22:32:53.09009+08:00","dependencies":[{"issue_id":"clier-42n","depends_on_id":"clier-j0g","type":"blocks","created_at":"2026-02-06T22:33:29.287877+08:00","created_by":"SomersStack"}]}
{"id":"clier-4gp","title":"Add watch, refresh, kill, send aliases and smart restart/reload","status":"closed","priority":2,"issue_type":"feature","owner":"olliesomers@me.com","created_at":"2026-02-01T14:35:02.596516+08:00","created_by":"SomersStack","updated_at":"2026-02-01T14:35:06.832642+08:00","closed_at":"2026-02-01T14:35:06.832642+08:00","close_reason":"Implemented in commit 4a34532: added watch, refresh, kill, send alias commands; refactored restart/reload to accept service names as positional args with --config for config path. Updated AGENTS.md, GETTING-STARTED.md, README.md."}
{"id":"clier-51m","title":"Path resolution tests fail due to macOS /private symlink","description":"## Summary\nProject root finding tests fail on macOS due to /var being a symlink to /private/var.\n\n## Affected Tests\n- tests/unit/utils/project-root.test.ts (14 tests failed)\n\n## Error Pattern\n```\nAssertionError: expected '/private/var/folders/vf/...' to be '/var/folders/vf/...'\n```\n\n## Root Cause\nmacOS symlinks /var -\u003e /private/var. The findProjectRoot function returns the resolved (real) path while tests expect the original path.\n\n## Test Output\n/private/tmp/claude/-Users-olliesomers-dev-clier/tasks/b6614b5.output\n\n## Possible Fixes\n1. Use fs.realpathSync() on expected paths in tests\n2. Normalize paths before comparison\n3. Use path comparison that accounts for symlinks","status":"closed","priority":2,"issue_type":"bug","owner":"olliesomers@me.com","created_at":"2026-01-23T18:51:24.786419+08:00","created_by":"SomersStack","updated_at":"2026-01-23T18:57:10.143759+08:00","closed_at":"2026-01-23T18:57:10.143759+08:00","close_reason":"Fixed by resolving symlinks in test setup using fs.realpathSync()"}
{"id":"clier-554","title":"Investigate forceExit: true — identify and fix dangling handles in tests","description":"## Problem\nThe vitest.config.ts file sets `forceExit: true`, which forces Vitest to exit after tests complete by killing any remaining handles (timers, open sockets, pending promises). This is a workaround, not a fix — it suggests that some test or source code is leaving dangling resources that prevent the Node.js process from exiting naturally.\n\n## Evidence from vitest.config.ts\n```typescript\n// Force vitest to exit after tests complete, killing any dangling handles\nforceExit: true,\n// Timeout for teardown hooks (afterEach, afterAll) before force exit\nteardownTimeout: 10000,\n```\n\nThe config also sets `hookTimeout: 30000` and uses threads pool (not forks) explicitly to prevent orphan processes — further evidence that resource cleanup has been a recurring issue.\n\n## Risks of forceExit: true\n1. **Masks resource leaks**: If tests leave open sockets, file handles, or timers, forceExit hides the problem rather than surfacing it. In production, these same leaks would cause memory growth and file descriptor exhaustion.\n2. **Masks async bugs**: If a test's afterAll/afterEach cleanup is broken, forceExit kills it silently instead of timing out and reporting the failure.\n3. **Can corrupt test output**: Force-killing the process while coverage data is being written can produce incomplete coverage reports.\n\n## Investigation steps\n1. Temporarily set `forceExit: false` and run the test suite to see which tests hang\n2. Use `--detectOpenHandles` (or Vitest's equivalent) to identify the specific handles keeping the process alive\n3. Common culprits: un-closed EventEmitter listeners, un-cleared setInterval/setTimeout, open Unix sockets from daemon tests, child processes not properly terminated\n4. Fix the root cause in each test's teardown, then remove forceExit\n\n## Priority rationale\nP2 — This isn't breaking anything today, but it's hiding problems. Fixing the root cause will improve test reliability and prevent resource leaks from reaching production. It's also a pre-requisite for accurate coverage reporting.","status":"open","priority":2,"issue_type":"bug","owner":"olliesomers@me.com","created_at":"2026-02-06T22:31:52.846141+08:00","created_by":"SomersStack","updated_at":"2026-02-06T22:33:24.257618+08:00"}
{"id":"clier-5lk","title":"Phase 2: PM2 Installer Script","description":"Cross-platform PM2 installer: detect package manager (lockfiles), detect OS (Darwin/macOS/Linux/Windows), install PM2 globally with retry logic and exponential backoff, handle EACCES with helpful guidance (NVM, no sudo), verify installation (pm2 -v, pm2 ping, PATH), comprehensive error handling (network, permissions, package manager not found), write tests with mocked child processes","status":"closed","priority":2,"issue_type":"task","owner":"olliesomers1@gmail.com","created_at":"2026-01-21T13:06:02.062076+08:00","created_by":"OliverSomers","updated_at":"2026-01-21T13:55:58.27238+08:00","closed_at":"2026-01-21T13:55:58.27238+08:00","close_reason":"Closed","labels":["cross-platform","installer","phase2"],"dependencies":[{"issue_id":"clier-5lk","depends_on_id":"clier-izj","type":"blocks","created_at":"2026-01-21T13:06:56.978455+08:00","created_by":"OliverSomers"}]}
{"id":"clier-6e9","title":"Fix continue-on-failure.test.ts timeouts (4/4 tests failing)","status":"closed","priority":2,"issue_type":"bug","owner":"olliesomers@me.com","created_at":"2026-01-23T19:16:00.203348+08:00","created_by":"SomersStack","updated_at":"2026-01-23T19:23:45.336518+08:00","closed_at":"2026-01-23T19:23:45.336518+08:00","close_reason":"All 4 continue-on-failure tests passing - issue already resolved"}
{"id":"clier-6lf","title":"Make circuit breaker backoff delays configurable for faster tests","status":"closed","priority":3,"issue_type":"feature","owner":"olliesomers@me.com","created_at":"2026-01-23T20:05:12.465941+08:00","created_by":"SomersStack","updated_at":"2026-01-23T20:09:15.075277+08:00","closed_at":"2026-01-23T20:09:15.075277+08:00","close_reason":"Implemented configurable circuit breaker options in config schema"}
{"id":"clier-6pg","title":"CRITICAL: Restore daemon architecture for multi-session agent use","description":"The PM2 removal broke the fundamental use case: multiple short-lived Claude Code agent sessions managing the same pipeline. OLD PM2 BEHAVIOR: (1) 'clier start' started watcher as PM2 daemon, returned immediately (2) PM2 daemon persisted independently (3) Any terminal could run 'clier status/logs/stop' and access the same processes. NEW BROKEN BEHAVIOR: (1) 'clier start' blocks terminal forever (2) All state trapped in that process's memory (3) Other terminals can't access ProcessManager/LogManager instances. SOLUTION NEEDED: Restore daemon mode. Options: (A) Bring back PM2 dependency, (B) Implement native daemon using detached child_process + IPC/socket, (C) Use alternative daemon manager. The native implementation was correct to fix PM2's race condition, but removing daemon persistence was a fatal regression.","status":"closed","priority":0,"issue_type":"bug","owner":"ollie@aglaiaim.com","created_at":"2026-01-22T15:53:07.679681+08:00","created_by":"Ollie Somers","updated_at":"2026-01-22T17:10:27.314599+08:00","closed_at":"2026-01-22T17:10:27.314599+08:00","close_reason":"Daemon architecture fully implemented - Phases 1-4 complete with working multi-agent session support"}
{"id":"clier-7et","title":"Add unit tests for CLI utilities (formatter, version-checker)","description":"## Problem\nTwo CLI utility modules have no test coverage:\n- src/cli/utils/formatter.ts — formats CLI output (tables, colors, status display)\n- src/cli/utils/version-checker.ts — checks for newer versions of clier on npm\n\n## What to test\n1. formatter.ts: Output formatting functions — verify table alignment, color codes, truncation of long values, handling of empty/null data, process status rendering\n2. version-checker.ts: Version comparison logic, npm registry fetch (mock HTTP), handling of network failures, caching behavior if present, semver comparison edge cases (pre-release, major vs minor)\n\n## Priority rationale\nP2 — formatter.ts bugs would produce garbled CLI output which impacts UX. version-checker.ts could produce false update prompts or crash on network failure. Neither is safety-critical but both are user-visible.","status":"closed","priority":2,"issue_type":"task","owner":"olliesomers@me.com","created_at":"2026-02-06T22:31:48.565856+08:00","created_by":"SomersStack","updated_at":"2026-02-06T22:49:54.854262+08:00","closed_at":"2026-02-06T22:49:54.854262+08:00","close_reason":"All tests written and passing. formatter.test.ts (61 tests), version-checker.test.ts (10 tests), and 14 command test files (76 tests) covering all 13 previously untested CLI commands."}
{"id":"clier-7ig","title":"Event template integration tests failing","description":"## Summary\nEvent template substitution tests are failing - templates not being substituted correctly or processes not starting.\n\n## Affected Tests\n- tests/integration/event-templates.test.ts (5 tests failed)\n\n## Error Patterns\n1. Consumer process not being started when it should be\n2. Environment variables not being substituted\n3. Templates not preserved when enable_event_templates is false\n4. Multiple template variables not substituted in commands\n5. Timestamp templates not substituted\n\n## Example Failure\n```\nAssertionError: expected [ 'producer' ] to include 'consumer'\nAssertionError: expected undefined not to be undefined (frontendEnv)\n```\n\n## Test Output\n/private/tmp/claude/-Users-olliesomers-dev-clier/tasks/b6614b5.output","status":"closed","priority":2,"issue_type":"bug","owner":"olliesomers@me.com","created_at":"2026-01-23T18:51:23.849338+08:00","created_by":"SomersStack","updated_at":"2026-01-23T18:56:22.527447+08:00","closed_at":"2026-01-23T18:56:22.527447+08:00","close_reason":"Fixed integration tests by properly wiring EventHandler and PatternMatcher between ProcessManager and Orchestrator"}
{"id":"clier-7u2","title":"Add unit tests for templates subsystem (schema, loader, renderer, types)","description":"## Problem\nThe entire src/templates/ directory has zero test coverage:\n- src/templates/types.ts — type definitions for template system\n- src/templates/schema.ts — Zod schema for template validation\n- src/templates/loader.ts — loads template files from disk\n- src/templates/renderer.ts — renders templates with variable substitution\n\nNote: src/utils/template.ts IS well-tested (37 test cases) but it's a completely different module — it handles event template substitution in pipeline configs. The src/templates/ directory is the project scaffolding template system used by the `clier init` and `clier template` CLI commands.\n\n## What to test\n1. schema.ts: Zod schema validation for template definitions — valid templates pass, invalid templates produce clear error messages\n2. loader.ts: Loading templates from filesystem — valid directory, missing directory, malformed template files, permission errors\n3. renderer.ts: Variable substitution in templates — placeholder replacement, missing variables, nested templates, file output\n4. types.ts: Likely type-only (may not need runtime tests), but verify\n\n## Priority rationale\nP2 — Lower risk than CLI commands and daemon since template rendering is used only during project initialization, not during runtime orchestration. However, a bug in template rendering could produce broken config files that are hard to diagnose.","status":"open","priority":2,"issue_type":"task","owner":"olliesomers@me.com","created_at":"2026-02-06T22:31:47.944172+08:00","created_by":"SomersStack","updated_at":"2026-02-06T22:32:23.766367+08:00"}
{"id":"clier-96o","title":"Add missing CLI integration tests","description":"Test suite has excellent unit (169 tests) and E2E coverage (14 tests), but zero CLI integration tests. Need tests for: clier start, clier stop, clier status, clier logs, clier validate commands. This is important because CLI commands interact with the filesystem, configuration loading, and process lifecycle in ways not covered by component tests.","status":"open","priority":2,"issue_type":"task","owner":"ollie@aglaiaim.com","created_at":"2026-01-22T15:46:35.598369+08:00","created_by":"Ollie Somers","updated_at":"2026-01-22T15:46:35.598369+08:00"}
{"id":"clier-a0n","title":"E2E tests timing out (circuit-breaker, pipeline, continue-on-failure)","description":"## Summary\nE2E tests are timing out during test runs, affecting circuit-breaker, pipeline, and continue-on-failure test suites.\n\n## Affected Tests\n- tests/e2e/circuit-breaker.test.ts (3 tests failed)\n- tests/e2e/pipeline.test.ts (3 tests failed)  \n- tests/e2e/continue-on-failure.test.ts (4 tests failed)\n\n## Error Pattern\n```\nTest timed out in 10000ms / 15000ms\nHook timed out in 10000ms\n```\n\n## Test Output\n/private/tmp/claude/-Users-olliesomers-dev-clier/tasks/b6614b5.output\n\n## Likely Cause\nCleanup/teardown issues - processes not being stopped properly, causing afterEach hooks to hang.","status":"closed","priority":2,"issue_type":"bug","owner":"olliesomers@me.com","created_at":"2026-01-23T18:51:22.905112+08:00","created_by":"SomersStack","updated_at":"2026-01-23T19:04:39.288735+08:00","closed_at":"2026-01-23T19:04:39.288735+08:00","close_reason":"Tests are now passing (10/10) - circuit-breaker, pipeline, and continue-on-failure E2E tests complete successfully"}
{"id":"clier-av7","title":"Implement circular dependency detection in Orchestrator","description":"The documentation claims Clier validates circular dependencies in pipeline configuration, and orchestrator.ts has comments about checking for circular dependencies, but the validation in validatePipeline() (lines 96-145) only checks for missing event references, not cycles. Need to implement actual circular dependency detection using graph traversal (e.g., DFS-based cycle detection) to prevent infinite trigger loops.","status":"open","priority":3,"issue_type":"feature","owner":"ollie@aglaiaim.com","created_at":"2026-01-22T15:46:45.995721+08:00","created_by":"Ollie Somers","updated_at":"2026-01-22T15:46:45.995721+08:00"}
{"id":"clier-azv","title":"Suppress noisy stderr output in service.test.ts error-path tests","description":"## Problem\nWhen running the test suite, tests/unit/cli/service.test.ts produces noisy stderr output for expected error paths. The test output includes lines like:\n\n```\nstderr | tests/unit/cli/service.test.ts \u003e Service Commands \u003e serviceStartCommand \u003e should return error when daemon is not running\n⚠ Clier daemon is not running\n\nstderr | tests/unit/cli/service.test.ts \u003e Service Commands \u003e serviceStartCommand \u003e should handle service not found error\n✗ Process \"my-service\" not found\n\nstderr | tests/unit/cli/service.test.ts \u003e Service Commands \u003e serviceStopCommand \u003e should return error when daemon is not running\n⚠ Clier daemon is not running\n```\n\nThis appears for ~10 test cases across start, stop, restart, add, and remove commands. While the tests all pass correctly, the noisy output makes it harder to spot real failures in CI logs and creates a false impression that something is wrong.\n\n## Suggested fix\nThe tests already spy on console.log (`vi.spyOn(console, 'log')`), but console.error/console.warn are not being suppressed. Add `vi.spyOn(console, 'error').mockImplementation(() =\u003e {})` and `vi.spyOn(console, 'warn').mockImplementation(() =\u003e {})` in the beforeEach, or configure Vitest's `silent` option for these tests.\n\n## Priority rationale\nP3 — Cosmetic issue. Tests pass correctly. But noisy output erodes confidence in CI — developers learn to ignore warnings, which means they'll also ignore real ones.","status":"closed","priority":3,"issue_type":"bug","owner":"olliesomers@me.com","created_at":"2026-02-06T22:31:51.165464+08:00","created_by":"SomersStack","updated_at":"2026-02-06T22:39:15.861867+08:00","closed_at":"2026-02-06T22:39:15.861867+08:00","close_reason":"Added console.error and console.warn mocks to service.test.ts beforeEach, suppressing expected error-path output from printError/printWarning"}
{"id":"clier-c3z","title":"Phase 7: Documentation \u0026 polish","description":"Update docs, add diagrams, troubleshooting guide","status":"open","priority":3,"issue_type":"task","owner":"ollie@aglaiaim.com","created_at":"2026-01-22T16:10:32.424123+08:00","created_by":"Ollie Somers","updated_at":"2026-01-22T16:10:32.424123+08:00","dependencies":[{"issue_id":"clier-c3z","depends_on_id":"clier-1p0","type":"blocks","created_at":"2026-01-22T16:12:42.993811+08:00","created_by":"Ollie Somers"}]}
{"id":"clier-c6y","title":"Phase 4: Configuration reload","description":"Implement hot reload in Watcher, update reload command","status":"closed","priority":2,"issue_type":"task","owner":"ollie@aglaiaim.com","created_at":"2026-01-22T16:10:32.121445+08:00","created_by":"Ollie Somers","updated_at":"2026-01-22T17:06:03.826368+08:00","closed_at":"2026-01-22T17:06:03.826368+08:00","close_reason":"Phase 4 complete: Configuration reload implemented and working","dependencies":[{"issue_id":"clier-c6y","depends_on_id":"clier-f7d","type":"blocks","created_at":"2026-01-22T16:12:42.831257+08:00","created_by":"Ollie Somers"}]}
{"id":"clier-cbl","title":"Fix LogManager ENOENT race condition in test cleanup","description":"## Problem\nDuring the test run, the LogManager tests produce repeated ENOENT errors in the output:\n\n```\nstderr | tests/unit/core/log-manager.test.ts \u003e LogManager \u003e flush \u003e should close all file streams on flush\n[error] [LogManager]: Log file stream error {\"processName\":\"rotation-test\",\"error\":\"ENOENT: no such file or directory, open '/var/folders/.../clier-log-test-.../rotation-test.log'\"}\n[error] [LogManager]: Log file stream error {\"processName\":\"graceful-rotation\",\"error\":\"ENOENT: ...\"}\n```\n\nThis error repeats ~10 times for the 'graceful-rotation' process. The tests still pass, which suggests the LogManager's error handler catches and logs the error without failing. However, the root cause appears to be a race condition: the temp directory is cleaned up (deleted) before all file stream operations complete, so the stream tries to write to a path that no longer exists.\n\n## Root cause hypothesis\nThe test creates a temp directory, opens log streams, then cleans up in afterEach. The LogManager's flush/close may be async and the temp directory deletion races with pending stream writes. The ENOENT happens when the stream tries to write after the directory is gone.\n\n## Suggested fix\n1. Ensure LogManager.flush() properly awaits all stream close operations before returning\n2. In the test, await flush() completion before deleting the temp directory\n3. Consider using stream.end() with a callback/promise rather than destroy()\n\n## Priority rationale\nP3 — Tests pass and the error handling works (it catches the ENOENT gracefully). But the race condition could mask a real bug in production where log rotation fails silently. The repeated error log noise (10+ lines) also clutters test output.","status":"closed","priority":3,"issue_type":"bug","owner":"olliesomers@me.com","created_at":"2026-02-06T22:31:51.858392+08:00","created_by":"SomersStack","updated_at":"2026-02-06T22:39:16.011553+08:00","closed_at":"2026-02-06T22:39:16.011553+08:00","close_reason":"Fixed race condition: rotateLogFile now tracks pending stream close promises in pendingCloses array, and flush() awaits them before returning. This prevents ENOENT errors from orphaned streams when test cleanup deletes temp directories."}
{"id":"clier-d4f","title":"Add unit tests for 13 untested CLI commands","description":"## Problem\n13 of 16 CLI command files in src/cli/commands/ have zero test coverage of their actual logic. The cli-setup.test.ts file mocks ALL command handlers — it tests Commander wiring but never exercises any command implementation.\n\n## Untested files\n- src/cli/commands/start.ts\n- src/cli/commands/stop.ts\n- src/cli/commands/restart.ts\n- src/cli/commands/reload.ts\n- src/cli/commands/init.ts\n- src/cli/commands/emit.ts\n- src/cli/commands/events.ts\n- src/cli/commands/input.ts\n- src/cli/commands/logs.ts\n- src/cli/commands/logs-clear.ts\n- src/cli/commands/status.ts\n- src/cli/commands/template.ts\n- src/cli/commands/docs.ts\n- src/cli/commands/update.ts (Note: validate.ts has an integration test, service.ts has a unit test — those are fine)\n\n## What good looks like\nThe existing tests/unit/cli/service.test.ts is the gold standard — it mocks the daemon client, tests each sub-command (start/stop/restart/add/remove), verifies RPC call arguments, checks exit codes, tests error paths (daemon not running, service not found, duplicate name), and verifies disconnect() cleanup behavior. Each of the 13 untested commands should follow the same pattern.\n\n## Priority rationale\nThese are the primary user-facing interface. Users interact with `clier start`, `clier stop`, `clier status`, `clier logs` daily. Bugs in argument parsing, error handling, or daemon communication in these commands would directly impact users. P1 because this is the largest coverage gap by file count and user exposure.","status":"closed","priority":1,"issue_type":"task","owner":"olliesomers@me.com","created_at":"2026-02-06T22:31:46.452725+08:00","created_by":"SomersStack","updated_at":"2026-02-06T22:49:54.916146+08:00","closed_at":"2026-02-06T22:49:54.916146+08:00","close_reason":"All tests written and passing. formatter.test.ts (61 tests), version-checker.test.ts (10 tests), and 14 command test files (76 tests) covering all 13 previously untested CLI commands."}
{"id":"clier-dev","title":"Performance tests timing out (event-processing)","description":"## Summary\nPerformance tests for event processing are timing out.\n\n## Affected Tests\n- tests/performance/event-processing.test.ts (2 tests failed)\n  - should maintain low event loop lag under load\n  - should handle burst events without dropping\n\n## Error Pattern\n```\nTest timed out in 5000ms\n```\n\n## Test Output\n/private/tmp/claude/-Users-olliesomers-dev-clier/tasks/b6614b5.output\n\n## Notes\nOther performance tests in the same file pass successfully (100+ events/sec, multiple event types, varying payload sizes).","status":"closed","priority":3,"issue_type":"bug","owner":"olliesomers@me.com","created_at":"2026-01-23T18:51:24.315207+08:00","created_by":"SomersStack","updated_at":"2026-01-23T19:04:54.335764+08:00","closed_at":"2026-01-23T19:04:54.335764+08:00","close_reason":"Tests are now passing (5/5) - all event processing performance tests complete successfully"}
{"id":"clier-emk","title":"Unit tests timing out (watcher, rate-limiter)","description":"## Summary\nUnit tests for watcher and rate-limiter are timing out during test runs.\n\n## Affected Tests\n- tests/unit/watcher.test.ts (11 tests failed)\n- tests/unit/safety/rate-limiter.test.ts (10 tests failed)\n\n## Error Pattern\n```\nTest timed out in 5000ms\nHook timed out in 10000ms\n```\n\n## Test Output\n/private/tmp/claude/-Users-olliesomers-dev-clier/tasks/b6614b5.output\n\n## Likely Cause\n- Watcher tests: cleanup not completing, possible event listener leaks (MaxListenersExceededWarning observed)\n- Rate-limiter tests: async operations not resolving properly","status":"closed","priority":2,"issue_type":"bug","owner":"olliesomers@me.com","created_at":"2026-01-23T18:51:23.376514+08:00","created_by":"SomersStack","updated_at":"2026-01-23T19:07:56.520345+08:00","closed_at":"2026-01-23T19:07:56.520345+08:00","close_reason":"Fixed watcher.test.ts timeouts by adding proper mocks for ProcessManager, EventBus, RateLimiter, Debouncer, CircuitBreaker, and signal handlers. Rate-limiter tests were already passing."}
{"id":"clier-f2w","title":"Phase 4: CLI Tool Implementation","description":"Build CLI with commands: start (load config, validate with Zod, start watcher, start entry points), stop (stop all processes), status (show running processes), logs \u003cname\u003e (tail logs), reload (reload config without restart), validate (validate schema, fail immediately on error). Implement start logic: read clier-pipeline.json, validate schema, inherit process.env, generate PM2 ecosystem in memory, start watcher first, then entry points. Write integration tests.","status":"closed","priority":2,"issue_type":"task","owner":"olliesomers1@gmail.com","created_at":"2026-01-21T13:06:25.679791+08:00","created_by":"OliverSomers","updated_at":"2026-01-21T14:35:59.753532+08:00","closed_at":"2026-01-21T14:35:59.753532+08:00","close_reason":"Closed","labels":["cli","integration-tests","phase4"],"dependencies":[{"issue_id":"clier-f2w","depends_on_id":"clier-wig","type":"blocks","created_at":"2026-01-21T13:06:57.239158+08:00","created_by":"OliverSomers"}]}
{"id":"clier-f7d","title":"Phase 2: Process management integration","description":"Expose ProcessManager via controller, update start/stop/status commands","status":"closed","priority":1,"issue_type":"task","owner":"ollie@aglaiaim.com","created_at":"2026-01-22T16:10:31.9208+08:00","created_by":"Ollie Somers","updated_at":"2026-01-22T17:05:10.398075+08:00","closed_at":"2026-01-22T17:05:10.398075+08:00","close_reason":"Phases 2\u00263 complete: ProcessManager and LogManager integrated with CLI commands","dependencies":[{"issue_id":"clier-f7d","depends_on_id":"clier-vyv","type":"blocks","created_at":"2026-01-22T16:12:42.721528+08:00","created_by":"Ollie Somers"}]}
{"id":"clier-hnv","title":"Phase 5: Robustness \u0026 error handling","description":"Handle stale files, health checks, graceful shutdown, recovery","status":"open","priority":2,"issue_type":"task","owner":"ollie@aglaiaim.com","created_at":"2026-01-22T16:10:32.220534+08:00","created_by":"Ollie Somers","updated_at":"2026-01-22T16:10:32.220534+08:00","dependencies":[{"issue_id":"clier-hnv","depends_on_id":"clier-f7d","type":"blocks","created_at":"2026-01-22T16:12:42.884493+08:00","created_by":"Ollie Somers"}]}
{"id":"clier-i1b","title":"Clier: PM2-Based Process Orchestration Framework","status":"closed","priority":2,"issue_type":"task","owner":"olliesomers1@gmail.com","created_at":"2026-01-21T13:05:24.231306+08:00","created_by":"OliverSomers","updated_at":"2026-01-21T15:21:15.200958+08:00","closed_at":"2026-01-21T15:21:15.200958+08:00","close_reason":"Closed","labels":["epic","typescript"]}
{"id":"clier-iad","title":"Phase 6: Production Hardening","description":"Error handling across all modules, structured logging with Winston, performance testing (100+ events/sec), memory leak testing, cross-platform testing (macOS, Linux, Windows), final code review and refinement","status":"closed","priority":2,"issue_type":"task","owner":"olliesomers1@gmail.com","created_at":"2026-01-21T13:06:51.689587+08:00","created_by":"OliverSomers","updated_at":"2026-01-21T15:19:24.099329+08:00","closed_at":"2026-01-21T15:19:24.099329+08:00","close_reason":"Closed","labels":["performance","phase6","production"],"dependencies":[{"issue_id":"clier-iad","depends_on_id":"clier-1ks","type":"blocks","created_at":"2026-01-21T13:06:57.497112+08:00","created_by":"OliverSomers"}]}
{"id":"clier-inw","title":"Fix test suite isolation - tests timeout when run together","description":"## Problem\nTests pass individually but timeout when running the full suite (350+ tests).\n\n## Affected Tests\n- tests/e2e/pipeline.test.ts\n- tests/e2e/circuit-breaker.test.ts  \n- tests/e2e/continue-on-failure.test.ts\n- tests/performance/event-processing.test.ts\n- tests/unit/safety/rate-limiter.test.ts\n\n## Root Cause\nvitest.config.ts uses `singleFork: true` which runs all tests sequentially in one process. This causes:\n- Resource contention (timers, event emitters, Bottleneck limiters)\n- Lingering state from previous tests affecting subsequent ones\n- Cumulative slowdown over 300+ tests\n\n## Potential Solutions\n1. Add proper cleanup (afterEach) to tests that use timers/limiters\n2. Increase test timeouts for E2E tests\n3. Consider running test suites in separate processes\n4. Review vitest poolOptions configuration","status":"closed","priority":2,"issue_type":"bug","owner":"olliesomers@me.com","created_at":"2026-01-23T19:37:30.237365+08:00","created_by":"SomersStack","updated_at":"2026-01-23T19:57:41.530755+08:00","closed_at":"2026-01-23T19:57:41.530755+08:00","close_reason":"Fixed by: 1) Adding afterEach cleanup to rate-limiter.test.ts to stop Bottleneck instances, 2) Removing singleFork: true from vitest config to enable parallel test execution, 3) Reducing E2E test timeouts. Full suite now runs in 8.5s (was 434s)."}
{"id":"clier-izj","title":"Phase 1: Project Setup \u0026 Configuration Schema","description":"Initialize TypeScript project with ESM, install dependencies (pm2, zod, bottleneck, opossum, winston, vitest), create Zod schema for clier-pipeline.json config, write TDD tests for schema validation","status":"closed","priority":2,"issue_type":"task","owner":"olliesomers1@gmail.com","created_at":"2026-01-21T13:05:49.970821+08:00","created_by":"OliverSomers","updated_at":"2026-01-21T13:34:50.666361+08:00","closed_at":"2026-01-21T13:34:50.666361+08:00","close_reason":"Closed","labels":["phase1","tdd","typescript"],"dependencies":[{"issue_id":"clier-izj","depends_on_id":"clier-i1b","type":"blocks","created_at":"2026-01-21T13:06:56.84127+08:00","created_by":"OliverSomers"}]}
{"id":"clier-j0g","title":"Replace weak E2E test assertions with real behavioral verification","description":"## Problem\nAll 4 E2E test files (pipeline.test.ts, continue-on-failure.test.ts, multi-pattern.test.ts, circuit-breaker.test.ts) share the same pattern of trivially-weak assertions. Nearly every test ends with:\n\n```typescript\nexpect(watcher).toBeDefined();\n```\n\nThis is always true since `watcher` was assigned on the preceding line. These tests function as smoke tests (verifying nothing crashes) but do NOT verify behavioral correctness.\n\n## Specific examples\n- tests/e2e/pipeline.test.ts line ~94: Test named 'should emit events in correct order' has a comment acknowledging event tracking is 'a bit tricky in E2E' then does NOT actually test event ordering. Assertion is just `expect(watcher).toBeDefined()`.\n- tests/e2e/pipeline.test.ts line ~109: Test named 'should not start dependent processes before trigger' uses a trigger (`manual:trigger`) that will never fire, but the assertion doesn't verify the dependent process remained unstarted.\n- Same pattern in continue-on-failure.test.ts, multi-pattern.test.ts, circuit-breaker.test.ts.\n\n## What real assertions should look like\n1. **Pipeline ordering**: Hook into the EventBus or ProcessManager to capture process start/stop events. Assert that step2 started AFTER step1 emitted its event. Assert that the service was running at the end.\n2. **Continue on failure**: Assert that downstream processes DID execute even after upstream failure when continue_on_failure=true. Assert that they did NOT when continue_on_failure=false.\n3. **Multi-pattern**: Assert that the process triggered by multiple patterns only started after ALL patterns matched, not just one.\n4. **Circuit breaker**: Assert that the circuit opened after the configured failure threshold and that requests were rejected while open.\n\n## Impact\nE2E tests are the last line of defense before production. If they only verify 'no crash' they provide false confidence. A regression that silently breaks event ordering, dependency resolution, or failure handling would pass the entire test suite undetected.\n\n## Priority rationale\nP1 — These tests exist and pass but provide near-zero safety. Fixing them is higher leverage than writing new tests because the test infrastructure (config generation, real process execution, cleanup) is already built. Only the assertions need to be replaced.","status":"open","priority":1,"issue_type":"bug","owner":"olliesomers@me.com","created_at":"2026-02-06T22:31:49.483666+08:00","created_by":"SomersStack","updated_at":"2026-02-06T22:32:44.014635+08:00"}
{"id":"clier-kk0","title":"Phase 3: Log management integration","description":"Expose LogManager via controller, update logs command","status":"closed","priority":1,"issue_type":"task","owner":"ollie@aglaiaim.com","created_at":"2026-01-22T16:10:32.022714+08:00","created_by":"Ollie Somers","updated_at":"2026-01-22T17:05:10.409869+08:00","closed_at":"2026-01-22T17:05:10.409869+08:00","close_reason":"Phases 2\u00263 complete: ProcessManager and LogManager integrated with CLI commands","dependencies":[{"issue_id":"clier-kk0","depends_on_id":"clier-vyv","type":"blocks","created_at":"2026-01-22T16:12:42.776798+08:00","created_by":"Ollie Somers"}]}
{"id":"clier-lcd","title":"Fix rate-limiter.test.ts timeouts (10/16 tests failing)","status":"closed","priority":2,"issue_type":"bug","owner":"olliesomers@me.com","created_at":"2026-01-23T19:15:59.727206+08:00","created_by":"SomersStack","updated_at":"2026-01-23T19:23:15.242433+08:00","closed_at":"2026-01-23T19:23:15.242433+08:00","close_reason":"All 16 rate-limiter tests passing - issue already resolved"}
{"id":"clier-lfe","title":"Fix event-processing.test.ts timeouts (2/5 tests failing)","status":"closed","priority":2,"issue_type":"bug","owner":"olliesomers@me.com","created_at":"2026-01-23T19:16:01.592874+08:00","created_by":"SomersStack","updated_at":"2026-01-23T19:21:46.018116+08:00","closed_at":"2026-01-23T19:21:46.018116+08:00","close_reason":"All 5 tests now passing - issue was already resolved"}
{"id":"clier-mdz","title":"Update project status and versioning in README","description":"Root README.md states project is in 'Phase 1: Project Setup \u0026 Configuration Schema' with upcoming phases for PM2 installer, core engine, etc. But the project is actually fully functional with 214 passing tests and all features implemented. Version is 0.2.0 but completeness suggests at least 0.5.0. Update README to reflect actual project state and maturity.","status":"open","priority":2,"issue_type":"task","owner":"ollie@aglaiaim.com","created_at":"2026-01-22T15:46:51.194511+08:00","created_by":"Ollie Somers","updated_at":"2026-01-22T15:46:51.194511+08:00"}
{"id":"clier-oxg","title":"Fix circuit-breaker.test.ts timeouts (3/3 tests failing)","status":"closed","priority":2,"issue_type":"bug","owner":"olliesomers@me.com","created_at":"2026-01-23T19:16:01.127246+08:00","created_by":"SomersStack","updated_at":"2026-01-23T19:22:24.327608+08:00","closed_at":"2026-01-23T19:22:24.327608+08:00","close_reason":"All 28 circuit-breaker tests passing - issue already resolved"}
{"id":"clier-qsz","title":"Investigate reload command functionality","description":"The CLI has a 'clier reload' command (src/cli/commands/reload.ts) inherited from the PM2 implementation. With PM2 removed, there's no daemon to send reload signals to. Need to investigate: (1) Does this command still work? (2) What should reload do in a foreground process model? (3) Should it be removed, repurposed, or does it need a different implementation?","status":"closed","priority":2,"issue_type":"bug","owner":"ollie@aglaiaim.com","created_at":"2026-01-22T15:46:30.403414+08:00","created_by":"Ollie Somers","updated_at":"2026-01-22T17:10:30.07295+08:00","closed_at":"2026-01-22T17:10:30.07295+08:00","close_reason":"Reload command now works via daemon IPC - hot reloads configuration without restart"}
{"id":"clier-rfk","title":"Add unit tests for daemon client/server IPC layer","description":"## Problem\nsrc/daemon/server.ts and src/daemon/client.ts have no test coverage whatsoever. src/daemon/index.ts (the daemon entry point) is also untested. Only src/daemon/controller.ts has unit tests.\n\nThe daemon is the core architectural component of clier — it's a persistent background process that multiple terminals/agents connect to via Unix sockets for shared process control. The client.ts module is mocked in service.test.ts but its actual connection logic, reconnection behavior, and error handling are never tested.\n\n## Specific risks\n- **server.ts**: Unix socket binding, connection acceptance, message framing/parsing, concurrent client handling, graceful shutdown, socket file cleanup. None of this is tested.\n- **client.ts**: Socket connection establishment, reconnection on disconnect, request/response correlation, timeout handling, error propagation to callers. The mock in service.test.ts replaces the entire module, so none of the real logic runs.\n- **index.ts**: Daemon lifecycle (start, stop, PID file management). Untested.\n\n## What to test\n1. server.ts: Socket creation, client connection/disconnection, message dispatch to controller, concurrent request handling, graceful shutdown (closing all connections), error handling for malformed messages\n2. client.ts: Connection establishment, request-response matching, timeout on unresponsive server, reconnection logic, disconnect cleanup, error propagation\n3. index.ts: Daemon start (socket bind, PID file), daemon stop (socket cleanup, PID removal), duplicate daemon detection\n\n## Priority rationale\nP1 — This is the highest-risk untested code. The daemon IPC layer is the foundation of clier's multi-session architecture. Connection failures, message corruption, and reconnection bugs in production would be catastrophic and extremely hard to debug without test coverage. The daemon/client interaction is the most complex networking code in the project.","status":"open","priority":1,"issue_type":"task","owner":"olliesomers@me.com","created_at":"2026-02-06T22:31:47.173814+08:00","created_by":"SomersStack","updated_at":"2026-02-06T22:32:17.951681+08:00"}
{"id":"clier-vyv","title":"Phase 1: Core daemon infrastructure","description":"Implement Daemon class, DaemonServer, DaemonController, DaemonClient, lifecycle management","status":"closed","priority":0,"issue_type":"task","owner":"ollie@aglaiaim.com","created_at":"2026-01-22T16:10:31.818489+08:00","created_by":"Ollie Somers","updated_at":"2026-01-22T16:19:15.292445+08:00","closed_at":"2026-01-22T16:19:15.292445+08:00","close_reason":"Phase 1 complete: Core daemon infrastructure implemented with all IPC components and CLI commands updated"}
{"id":"clier-wig","title":"Phase 3: Core Watcher Service","description":"Build orchestration engine with: PM2 launchBus integration (log:out, log:err, process:event), regex pattern matching on stdout/stderr (emit ALL matching events), event emission (:success on exit 0, :error on stderr, :crashed on crash), pipeline orchestration (track triggers, start dependents via PM2 API, handle continue_on_failure), safety mechanisms (debounce, rate limiting with Bottleneck, circuit breaker with Opossum, webhook via event system), write unit tests mocking PM2 APIs","status":"closed","priority":2,"issue_type":"task","owner":"olliesomers1@gmail.com","created_at":"2026-01-21T13:06:15.253699+08:00","created_by":"OliverSomers","updated_at":"2026-01-21T14:18:32.209286+08:00","closed_at":"2026-01-21T14:18:32.209286+08:00","close_reason":"Closed","labels":["core","orchestration","phase3","tdd"],"dependencies":[{"issue_id":"clier-wig","depends_on_id":"clier-5lk","type":"blocks","created_at":"2026-01-21T13:06:57.109978+08:00","created_by":"OliverSomers"}]}
{"id":"clier-x84","title":"Enable parallel test execution for unit tests","status":"closed","priority":3,"issue_type":"feature","owner":"olliesomers@me.com","created_at":"2026-01-23T20:05:28.549941+08:00","created_by":"SomersStack","updated_at":"2026-01-23T20:15:58.627921+08:00","closed_at":"2026-01-23T20:15:58.627921+08:00","close_reason":"Implemented parallel test execution with vitest workspace configuration"}
{"id":"clier-yyi","title":"Fix pipeline.test.ts timeouts (3/3 tests failing)","status":"closed","priority":2,"issue_type":"bug","owner":"olliesomers@me.com","created_at":"2026-01-23T19:16:00.66539+08:00","created_by":"SomersStack","updated_at":"2026-01-23T19:22:57.330149+08:00","closed_at":"2026-01-23T19:22:57.330149+08:00","close_reason":"All 3 pipeline tests passing - issue already resolved"}
